---
title: "ゼロから作るCatsライブラリ ~ Semigroup編 ~"
emoji: "🐱"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Scala"]
published: false
---

# はじめに
はじめまして。やがです。普段はScalaを用いて保育園の業務支援SaaSの開発をしています。
Zennは初投稿になります💪

筆者は関数型プログラミングに入門したばかりであるため、なるべく誤りがないよう試行錯誤しながら記事を書いていますが、もし誤っている点等があればコメントで指摘していただけるととても嬉しいです。

## Catsライブラリの概要
CatsライブラリはScala言語で使用することができる関数型プログラミングライブラリです。名前の由来は圏(_category_)の省略系であると公式ドキュメントに書かれています。関数型プログラミングに大きな影響を与えている圏論との繋がりを感じますね。

Catsライブラリには関数型プログラミングのツールのようなものが多く用意されています。そしてこれらのツールの大部分は型クラスと呼ばれるプログラミングパターンで実装されています。

型クラスについては後の項目で簡単に紹介します。

## 本記事の内容

本記事のゴールは以下のテストを通すことです。

```scala
class OptionInstancesTest extends AnyFunSuite {
  test("semigroup") {
    assert((Option(3)  |+| Option(4)) == Option(7))
    assert((Option(10) |+| Option(5)) == Option(15))
  }
}
```

以上のテストでは、`Option[Int]`型である2つの値を、`|+|`メソッドにより1つの値にまとめています。**まとめる**と書きましたが、具体的には2つの`Option[Int]型`の値が内包する`Int`型の値を加算した結果を、1つの`Option[Int]`型に包んで返すというシンプルな処理です。

`|+|`メソッドはScala標準ライブラリには実装されておらず、Scalaの標準ライブラリのみでは以上のテストは通りません。Catsライブラリにおいて`|+|`メソッドは、`Semigroup`という型クラスを使用することにより提供されます。
:::message
Catsにおいて、テストコードのような`Option[T]`型に対する`|+|`メソッドは、厳密には`Monoid`型クラスによって提供されますが、説明の都合により上記のような表現としています。
:::

本記事ではCatsライブラリを用いず、`|+|`メソッドを提供する`Semigroup`の型クラスをゼロから実装していく過程を紹介します。

# 型クラスとは
## 型クラスの概要
型クラスとはHaskellに由来するプログラミングパターンです。型クラスでは既存のプリミティブ型や標準ライブラリ等のソースコードに変更を加えることなく、新しい機能を拡張して追加することができます。

テストコードを例に挙げると、`Option[Int]`型のインスタンスに`|+|`メソッドを用意するためには、通常の`trait`を用いると以下のような実装イメージになるかと思います。（あくまでイメージです。）

```scala
trait Semigroupa[A] {
  def |+|(rhs: A): A
}

class Option[T](value: T) extends Semigroup[Option[T]] {
  def |+|(rhs: Option[T]): Option[T] = Option(value + rhs.value)
}
```
しかし、`Option[T]`型はScalaの標準ライブラリで定義されている既存のクラスであるため、上記のコードのように後からクラス定義を書き換えることはできません。

以上のような問題を解決できるのが型クラスです。

より専門的な言葉を用いると、「アドホック多相を実現するデザインパターン」といったような説明が正しいように学んでいます。

## Scalaにおける型クラス
Scalaでは`implicit`の機能を用いることによって、型クラスを実装できます。

Scalaの型クラスは主に以下の3つのコンポーネントによって実装することができます。
1. 型クラス自体の`trait`定義
2. 型クラスのインスタンスを提供する`implicit value`
3. 型クラスを使用するための`implicit parameter`

また型クラスをより便利に使用するための手段として、`implicit conversion`を組み合わせた`Enrich my library`というパターンを用いる事ができます。

`implicit`の機能を用いて実際にどのように型クラスを実装するかは、後の`Semigroup`を実装していく項目を見ていただければと思います。